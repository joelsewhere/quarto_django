{% load static %}
{% load tags %}

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
        <script>
    function CopyToClipboard(id)
    {
        var copyText = document.getElementById(id);

        // Select the text field
        copyText.select();
        copyText.setSelectionRange(0, 99999); // For mobile devices

        // Copy the text inside the text field
        navigator.clipboard.writeText(copyText.value);

        var button = document.getElementById("copy-button")
        button.style.background = "grey";
        button.textContent = 'Copied!'
    }
    </script>
    <textarea id="share_link" style="display: none;">{% call_method request.user 'generate_share_link' request.path %}</textarea>
        
        <!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head>
<meta charset="utf-8"/>
<meta content="quarto-1.3.361" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="Jo-L Collins" name="author"/>
<meta content="2023-09-13" name="dcterms.date"/>
<title>Irondata - Matriculation Modeling 60-21 Days</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>
<script src="{% static 'site_libs/quarto-nav/quarto-nav.js' %}"></script>
<script src="{% static 'site_libs/quarto-nav/headroom.min.js' %}"></script>
<script src="{% static 'site_libs/clipboard/clipboard.min.js' %}"></script>
<script src="{% static 'site_libs/quarto-search/autocomplete.umd.js' %}"></script>
<script src="{% static 'site_libs/quarto-search/fuse.min.js' %}"></script>
<script src="{% static 'site_libs/quarto-search/quarto-search.js' %}"></script>
<meta content="../../../" name="quarto:offset"/>
<script src="{% static 'site_libs/quarto-html/quarto.js' %}"></script>
<script src="{% static 'site_libs/quarto-html/popper.min.js' %}"></script>
<script src="{% static 'site_libs/quarto-html/tippy.umd.min.js' %}"></script>
<script src="{% static 'site_libs/quarto-html/anchor.min.js' %}"></script>
<link href="{% static 'site_libs/quarto-html/tippy.css' %}" rel="stylesheet"/>
<link href="{% static 'site_libs/quarto-html/quarto-syntax-highlighting.css' %}" id="quarto-text-highlighting-styles" rel="stylesheet"/>
<script src="{% static 'site_libs/bootstrap/bootstrap.min.js' %}"></script>
<link href="{% static 'site_libs/bootstrap/bootstrap-icons.css' %}" rel="stylesheet"/>
<link data-mode="light" href="{% static 'site_libs/bootstrap/bootstrap.min.css' %}" id="quarto-bootstrap" rel="stylesheet"/>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script crossorigin="anonymous" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script crossorigin="anonymous" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<link href="{% static 'styles.css' %}" rel="stylesheet"/>
</head>
<body class="nav-fixed">
<div id="quarto-search-results"></div>
<header class="headroom fixed-top" id="quarto-header">
<nav class="navbar navbar-expand-lg navbar-dark">
<div class="navbar-container container-fluid">
<div class="navbar-brand-container">
<a class="navbar-brand" href="/index.html">
<span class="navbar-title">Irondata</span>
</a>
</div>
<div class="" id="quarto-search" title="Search"></div>
<button aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#navbarCollapse" data-bs-toggle="collapse" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarCollapse">
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
<a class="nav-link" href="/about.html" rel="" target="">
<span class="menu-text">About</span></a>
</li>
<li class="nav-item">
<a class="nav-link" href="/logout" rel="" target=""><i class="bi bi-door-closed" role="img">
</i>
<span class="menu-text">Logout</span></a>
</li>
</ul>
<div class="quarto-navbar-tools">
</div>
</div> <!-- /navcollapse -->
</div> <!-- /container-fluid -->
</nav>
</header>
<!-- content -->
<div class="quarto-container page-columns page-rows-contents page-layout-full page-navbar" id="quarto-content">
<!-- sidebar -->
<!-- margin-sidebar -->
<!-- main -->
<main class="content column-page" id="quarto-document-content">
<header class="quarto-title-block default" id="title-block-header">
<div class="quarto-title">
<h1 class="title">Matriculation Modeling 60-21 Days</h1>
</div>
<div class="quarto-title-meta">
<div>
<div class="quarto-title-meta-heading">Author</div>
<div class="quarto-title-meta-contents">
<p>Jo-L Collins </p>
</div>
</div>
<div>
<div class="quarto-title-meta-heading">Published</div>
<div class="quarto-title-meta-contents">
<p class="date">September 13, 2023</p>
</div>
</div>
</div>
<button class="copy-button btn btn-primary" id="copy-button" onclick="CopyToClipboard('share_link')" type="button">Copy Share Link</button></header>
<section class="level4" id="in-the-last-3-months-matriculation-projections-generated-21-60-days-prior-to-a-cohort-start-date-have-had-an-average-error-between--5-and-11.">
<h4 class="anchored" data-anchor-id="in-the-last-3-months-matriculation-projections-generated-21-60-days-prior-to-a-cohort-start-date-have-had-an-average-error-between--5-and-11.">In the last 3 months, matriculation projections (generated 21-60 days prior to a cohort start date) have had an average error between -5 and 11.</h4>
<div class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-3-output-1.png' %}"/></p>
</div>
</div>
<p>From a probabilistic perspective, <strong>the data team’s goals for modeling error are the following:</strong></p>
<ul>
<li><strong>Error should land between -10 and 10.</strong>
<ul>
<li>Occasional outliers that fall between -15 and 15 are acceptable.</li>
<li><strong>Errors beyond -15/15 are operationally concering to Flatiron’s business</strong></li>
</ul></li>
<li>When error occurs <strong>under prediction is better than over prediction</strong></li>
</ul>
</section>
<section class="level3" id="error-is-complicated">
<h3 class="anchored" data-anchor-id="error-is-complicated">Error is complicated</h3>
<p>In aggregate our current modeling process is meeting our goals. But this aggregate view of modeling error does not tell the entire story.</p>
<section class="level4" id="if-we-look-at-forecasting-error-over-time-modeling-performance-becomes-a-bit-more-of-a-mixed-bag.">
<h4 class="anchored" data-anchor-id="if-we-look-at-forecasting-error-over-time-modeling-performance-becomes-a-bit-more-of-a-mixed-bag.">If we look at forecasting error over time, modeling performance becomes a bit more of a mixed bag.</h4>
<div class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-4-output-1.png' %}"/></p>
</div>
</div>
<p>Overall, we are managing to stay within our error goals, but occasional start dates experience error that is well beyond out set error boundaries. <strong>Notably, these errors are mostly over predicting</strong>, which is an additional cause for concern.</p>
</section>
</section>
<section class="level3" id="so-why-is-this-happening">
<h3 class="anchored" data-anchor-id="so-why-is-this-happening">So why is this happening?</h3>
<div class="cell" data-execution_count="5">
<details>
<summary>Show Project Data Query</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a aria-hidden="true" href="#cb1-1" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb1-2"><a aria-hidden="true" href="#cb1-2" tabindex="-1"></a><span class="st">select * from (</span></span>
<span id="cb1-3"><a aria-hidden="true" href="#cb1-3" tabindex="-1"></a><span class="st">select cohort_start_date::varchar</span></span>
<span id="cb1-4"><a aria-hidden="true" href="#cb1-4" tabindex="-1"></a><span class="st">     , date_part(month, c.date) "month"</span></span>
<span id="cb1-5"><a aria-hidden="true" href="#cb1-5" tabindex="-1"></a><span class="st">     , datediff(day, c.date, cohort_start_date) days_till_start</span></span>
<span id="cb1-6"><a aria-hidden="true" href="#cb1-6" tabindex="-1"></a><span class="st">     , count(distinct cohort_uuid) num_cohorts</span></span>
<span id="cb1-7"><a aria-hidden="true" href="#cb1-7" tabindex="-1"></a><span class="st">     , count(distinct case when modality = 'Live' then r.cohort_uuid end) num_live</span></span>
<span id="cb1-8"><a aria-hidden="true" href="#cb1-8" tabindex="-1"></a><span class="st">     , count(distinct case when modality = 'Flex' then r.cohort_uuid end) num_flex</span></span>
<span id="cb1-9"><a aria-hidden="true" href="#cb1-9" tabindex="-1"></a><span class="st">     , count(distinct case when modality = 'Campus' then r.cohort_uuid end) num_campus</span></span>
<span id="cb1-10"><a aria-hidden="true" href="#cb1-10" tabindex="-1"></a><span class="st">     , count(distinct case when discipline = 'Software Engineering' then r.cohort_uuid end) num_se</span></span>
<span id="cb1-11"><a aria-hidden="true" href="#cb1-11" tabindex="-1"></a><span class="st">     , count(distinct case when discipline = 'Data Science' then r.cohort_uuid end) num_ds</span></span>
<span id="cb1-12"><a aria-hidden="true" href="#cb1-12" tabindex="-1"></a><span class="st">     , count(distinct case when discipline not in ('Software Engineering', 'Data Science') then r.cohort_uuid end) num_emerging</span></span>
<span id="cb1-13"><a aria-hidden="true" href="#cb1-13" tabindex="-1"></a><span class="st">     , max(distinct case when nvl(a.application_discipline, '') = 'Software Engineering' then a.applications else 0 end) apps_se</span></span>
<span id="cb1-14"><a aria-hidden="true" href="#cb1-14" tabindex="-1"></a><span class="st">     , max(distinct case when nvl(a.application_discipline, '') = 'Data Science' then a.applications else 0 end) apps_ds</span></span>
<span id="cb1-15"><a aria-hidden="true" href="#cb1-15" tabindex="-1"></a><span class="st">     , max(distinct case when nvl(a.application_discipline, '') not in ('Software Engineering', 'Data Science', '') then a.applications else 0 end) apps_emerging</span></span>
<span id="cb1-16"><a aria-hidden="true" href="#cb1-16" tabindex="-1"></a><span class="st">     , count(distinct r.learn_uuid) num_registered</span></span>
<span id="cb1-17"><a aria-hidden="true" href="#cb1-17" tabindex="-1"></a><span class="st">     , count(distinct case when nvl(r.admitted_date, current_date) &lt;= c.date and nvl(r.committed_date, current_date) &gt; c.date then r.learn_uuid end) num_admitted</span></span>
<span id="cb1-18"><a aria-hidden="true" href="#cb1-18" tabindex="-1"></a><span class="st">     , count(distinct case when nvl(r.committed_date, current_date) &lt;= c.date then r.learn_uuid end) num_committed</span></span>
<span id="cb1-19"><a aria-hidden="true" href="#cb1-19" tabindex="-1"></a><span class="st">     , count(case when scholarship_amount is not null and scholarship_amount &gt; 0 then 1 end) scholarships_given</span></span>
<span id="cb1-20"><a aria-hidden="true" href="#cb1-20" tabindex="-1"></a><span class="st">from fis.rosters r</span></span>
<span id="cb1-21"><a aria-hidden="true" href="#cb1-21" tabindex="-1"></a><span class="st">join fis.calendar c</span></span>
<span id="cb1-22"><a aria-hidden="true" href="#cb1-22" tabindex="-1"></a><span class="st">on c.date between r.added_to_cohort_date and nvl(r.removed_from_cohort_date, current_date)</span></span>
<span id="cb1-23"><a aria-hidden="true" href="#cb1-23" tabindex="-1"></a><span class="st">left join (</span></span>
<span id="cb1-24"><a aria-hidden="true" href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a aria-hidden="true" href="#cb1-25" tabindex="-1"></a><span class="st">    select c2.date </span></span>
<span id="cb1-26"><a aria-hidden="true" href="#cb1-26" tabindex="-1"></a><span class="st">         , a.application_discipline</span></span>
<span id="cb1-27"><a aria-hidden="true" href="#cb1-27" tabindex="-1"></a><span class="st">         , count(distinct a.learn_uuid) applications</span></span>
<span id="cb1-28"><a aria-hidden="true" href="#cb1-28" tabindex="-1"></a><span class="st">    from fis.admissions a</span></span>
<span id="cb1-29"><a aria-hidden="true" href="#cb1-29" tabindex="-1"></a><span class="st">    left join fis.calendar c2</span></span>
<span id="cb1-30"><a aria-hidden="true" href="#cb1-30" tabindex="-1"></a><span class="st">    on c2.date &gt;= a.application_submission_date</span></span>
<span id="cb1-31"><a aria-hidden="true" href="#cb1-31" tabindex="-1"></a><span class="st">    and c2.date &lt; nvl(a.original_admitted_date, a.close_date, current_date)</span></span>
<span id="cb1-32"><a aria-hidden="true" href="#cb1-32" tabindex="-1"></a><span class="st">    where datediff(day, a.application_submission_date, c2.date) between 0 and 90</span></span>
<span id="cb1-33"><a aria-hidden="true" href="#cb1-33" tabindex="-1"></a><span class="st">    group by c2.date, a.application_discipline</span></span>
<span id="cb1-34"><a aria-hidden="true" href="#cb1-34" tabindex="-1"></a><span class="st">    ) a</span></span>
<span id="cb1-35"><a aria-hidden="true" href="#cb1-35" tabindex="-1"></a><span class="st">on c.date = a.date</span></span>
<span id="cb1-36"><a aria-hidden="true" href="#cb1-36" tabindex="-1"></a><span class="st">where datediff(day, c.date, cohort_start_date) between 0 and 60</span></span>
<span id="cb1-37"><a aria-hidden="true" href="#cb1-37" tabindex="-1"></a><span class="st">and cohort_start_date &gt; '2022-01-01'::date</span></span>
<span id="cb1-38"><a aria-hidden="true" href="#cb1-38" tabindex="-1"></a><span class="st">and cohort_start_date &lt; current_date</span></span>
<span id="cb1-39"><a aria-hidden="true" href="#cb1-39" tabindex="-1"></a><span class="st">and cohort_start_date != '2023-02-27'</span></span>
<span id="cb1-40"><a aria-hidden="true" href="#cb1-40" tabindex="-1"></a><span class="st">group by 1, 2, 3</span></span>
<span id="cb1-41"><a aria-hidden="true" href="#cb1-41" tabindex="-1"></a><span class="st">) cohorts</span></span>
<span id="cb1-42"><a aria-hidden="true" href="#cb1-42" tabindex="-1"></a><span class="st">left join (</span></span>
<span id="cb1-43"><a aria-hidden="true" href="#cb1-43" tabindex="-1"></a></span>
<span id="cb1-44"><a aria-hidden="true" href="#cb1-44" tabindex="-1"></a><span class="st">  select matriculated_cohort_start_date::varchar cohort_start_date</span></span>
<span id="cb1-45"><a aria-hidden="true" href="#cb1-45" tabindex="-1"></a><span class="st">       , count(*) matriculations </span></span>
<span id="cb1-46"><a aria-hidden="true" href="#cb1-46" tabindex="-1"></a><span class="st">  from fis.admissions group by 1  </span></span>
<span id="cb1-47"><a aria-hidden="true" href="#cb1-47" tabindex="-1"></a></span>
<span id="cb1-48"><a aria-hidden="true" href="#cb1-48" tabindex="-1"></a><span class="st">) matriculations</span></span>
<span id="cb1-49"><a aria-hidden="true" href="#cb1-49" tabindex="-1"></a><span class="st">on cohorts.cohort_start_date = matriculations.cohort_start_date</span></span>
<span id="cb1-50"><a aria-hidden="true" href="#cb1-50" tabindex="-1"></a></span>
<span id="cb1-51"><a aria-hidden="true" href="#cb1-51" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb1-52"><a aria-hidden="true" href="#cb1-52" tabindex="-1"></a></span>
<span id="cb1-53"><a aria-hidden="true" href="#cb1-53" tabindex="-1"></a>df <span class="op">=</span> hook.get_pandas_df(query).dropna()</span>
<span id="cb1-54"><a aria-hidden="true" href="#cb1-54" tabindex="-1"></a>df <span class="op">=</span> df.iloc[:, :<span class="op">-</span><span class="dv">2</span>].assign(matriculations<span class="op">=</span>df.iloc[:,<span class="op">-</span><span class="dv">1</span>])</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>A key driver of this problem is the variance in the number of cohorts launched between start dates.</strong></p>
<div class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-7-output-1.png' %}"/></p>
</div>
</div>
<p>At 60-21 days prior to a cohort start date, we have a couple models contributing to our overall prediction, but the primary model at this stage of the admissions funnel counts the number of students who are registered, committed, and enrolled, and then multiplies those numbers with a running historical conversion rate. This tends to work quite well for cohort start dates with 1-3 cohorts, but the conversion rates for larger cohort start dates are more variable, and tend to diverge around 60 day and 15 days.</p>
<div class="cell" data-execution_count="7">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-8-output-1.png' %}"/></p>
</div>
</div>
<p>We have seperate models that perform quite well &lt;21 days, so <strong>this report will focus on minimizing the error caused by the divergance seen 42-60 days out from a cohort start.</strong></p>
<p>A viable solution to this problem is to build a model that focuses on the size of the cohort start date, and does not consider conversion rate.</p>
<p><em>Let’s give it a shot!</em>.</p>
<p>To start, I’m going to first create a highly simple model that only considers the number of cohorts for a given start date. The dataset looks like this:</p>
<div class="cell" data-execution_count="8">
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<table class="dataframe table table-sm table-striped small" data-border="1" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cohort Start Date</th>
<th data-quarto-table-cell-role="th">Number of Cohorts</th>
<th data-quarto-table-cell-role="th">Matriculations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2022-05-16</td>
<td>12</td>
<td>225.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2022-04-25</td>
<td>8</td>
<td>135.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2022-04-04</td>
<td>12</td>
<td>188.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2022-06-06</td>
<td>10</td>
<td>126.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2022-03-14</td>
<td>9</td>
<td>159.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>When we plot <code>Number of Cohorts</code> against <code>Matriculations</code>, we can see a very clear linear relationship:</p>
<div class="cell" data-execution_count="9">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-10-output-1.png' %}"/></p>
</div>
</div>
<p>Let’s generate this model, and compare its performance to the performance visualized at the top of this report.</p>
<p>This evaluation process will train a linear regression model on all cohorts prior to <code>06-26-2023</code> and will use the 8 cohorts on and after <code>06-26-2023</code> for testing the model’s predictive accuracy.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>View Training Data Generation</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a aria-hidden="true" href="#cb2-1" tabindex="-1"></a>training_cutoff_date <span class="op">=</span> <span class="st">'2023-06-26'</span></span>
<span id="cb2-2"><a aria-hidden="true" href="#cb2-2" tabindex="-1"></a>training <span class="op">=</span> df.query(<span class="ss">f'cohort_start_date &lt; "</span><span class="sc">{</span>training_cutoff_date<span class="sc">}</span><span class="ss">"'</span>)</span>
<span id="cb2-3"><a aria-hidden="true" href="#cb2-3" tabindex="-1"></a>testing <span class="op">=</span> df.query(<span class="ss">f'cohort_start_date &gt;= "</span><span class="sc">{</span>training_cutoff_date<span class="sc">}</span><span class="ss">"'</span>)</span>
<span id="cb2-4"><a aria-hidden="true" href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a aria-hidden="true" href="#cb2-5" tabindex="-1"></a>X_train, X_test <span class="op">=</span> training[features], testing[features]</span>
<span id="cb2-6"><a aria-hidden="true" href="#cb2-6" tabindex="-1"></a>y_train, y_test <span class="op">=</span> training[target], testing[target]</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we will…</p>
<ul>
<li>Fit a Linear Regression model to the training</li>
<li>Visualize performance against our currently running model</li>
</ul>
<div class="cell" data-execution_count="11">
<details>
<summary>View Model Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a aria-hidden="true" href="#cb3-1" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb3-2"><a aria-hidden="true" href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a aria-hidden="true" href="#cb3-3" tabindex="-1"></a>simple_model <span class="op">=</span> LinearRegression()</span>
<span id="cb3-4"><a aria-hidden="true" href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a aria-hidden="true" href="#cb3-5" tabindex="-1"></a>simple_model.fit(X_train, y_train)</span>
<span id="cb3-6"><a aria-hidden="true" href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a aria-hidden="true" href="#cb3-7" tabindex="-1"></a><span class="kw">def</span> score_on_testing(model, testing, average_preds<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb3-8"><a aria-hidden="true" href="#cb3-8" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">8</span>))</span>
<span id="cb3-9"><a aria-hidden="true" href="#cb3-9" tabindex="-1"></a>    frame <span class="op">=</span> testing.assign(pred<span class="op">=</span>model.predict(testing[features]))</span>
<span id="cb3-10"><a aria-hidden="true" href="#cb3-10" tabindex="-1"></a>    <span class="cf">for</span> cohort, ax <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">sorted</span>(frame.cohort_start_date.unique()), axs.ravel()):</span>
<span id="cb3-11"><a aria-hidden="true" href="#cb3-11" tabindex="-1"></a>        frame_ <span class="op">=</span> frame[frame.cohort_start_date <span class="op">==</span> cohort].sort_values(<span class="st">'days_till_start'</span>).query(<span class="st">'days_till_start &gt;= 21'</span>)</span>
<span id="cb3-12"><a aria-hidden="true" href="#cb3-12" tabindex="-1"></a>        looker <span class="op">=</span> looker_error[cohort]</span>
<span id="cb3-13"><a aria-hidden="true" href="#cb3-13" tabindex="-1"></a>        ax.fill_between(series.index, <span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, color<span class="op">=</span><span class="st">'green'</span>, alpha<span class="op">=</span><span class="fl">.3</span>, label<span class="op">=</span><span class="st">'Error Goal'</span>)</span>
<span id="cb3-14"><a aria-hidden="true" href="#cb3-14" tabindex="-1"></a>        ax.plot(frame_.days_till_start, frame_.pred <span class="op">-</span> frame_.matriculations, label<span class="op">=</span><span class="st">'Simple Model'</span>)</span>
<span id="cb3-15"><a aria-hidden="true" href="#cb3-15" tabindex="-1"></a>        ax.plot(looker.index, looker.values, label<span class="op">=</span><span class="st">'Production Model'</span>)</span>
<span id="cb3-16"><a aria-hidden="true" href="#cb3-16" tabindex="-1"></a>        ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'black'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Zero Error'</span>)</span>
<span id="cb3-17"><a aria-hidden="true" href="#cb3-17" tabindex="-1"></a>        <span class="cf">if</span> average_preds:</span>
<span id="cb3-18"><a aria-hidden="true" href="#cb3-18" tabindex="-1"></a>            frame_ <span class="op">=</span> frame_.set_index(<span class="st">'days_till_start'</span>)</span>
<span id="cb3-19"><a aria-hidden="true" href="#cb3-19" tabindex="-1"></a>            average <span class="op">=</span> ((frame_.pred <span class="op">+</span> looker <span class="op">+</span> frame_.matriculations)<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> frame_.matriculations</span>
<span id="cb3-20"><a aria-hidden="true" href="#cb3-20" tabindex="-1"></a>            ax.plot(average.index, average, label<span class="op">=</span><span class="st">'Error - Average of Both Model Predictions'</span>)</span>
<span id="cb3-21"><a aria-hidden="true" href="#cb3-21" tabindex="-1"></a>        ax.invert_xaxis()</span>
<span id="cb3-22"><a aria-hidden="true" href="#cb3-22" tabindex="-1"></a>        ax.set_title(cohort)</span>
<span id="cb3-23"><a aria-hidden="true" href="#cb3-23" tabindex="-1"></a>        </span>
<span id="cb3-24"><a aria-hidden="true" href="#cb3-24" tabindex="-1"></a> </span>
<span id="cb3-25"><a aria-hidden="true" href="#cb3-25" tabindex="-1"></a></span>
<span id="cb3-26"><a aria-hidden="true" href="#cb3-26" tabindex="-1"></a>    handles, labels <span class="op">=</span> ax.get_legend_handles_labels()</span>
<span id="cb3-27"><a aria-hidden="true" href="#cb3-27" tabindex="-1"></a>    fig.legend(handles, labels, fontsize<span class="op">=</span><span class="dv">12</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>,<span class="fl">1.15</span>))</span>
<span id="cb3-28"><a aria-hidden="true" href="#cb3-28" tabindex="-1"></a>    fig.supylabel(<span class="st">'Error'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb3-29"><a aria-hidden="true" href="#cb3-29" tabindex="-1"></a>    fig.supxlabel(<span class="st">'Days Until Start'</span>, fontsize<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb3-30"><a aria-hidden="true" href="#cb3-30" tabindex="-1"></a>    fig.tight_layout()</span>
<span id="cb3-31"><a aria-hidden="true" href="#cb3-31" tabindex="-1"></a>    </span>
<span id="cb3-32"><a aria-hidden="true" href="#cb3-32" tabindex="-1"></a>score_on_testing(simple_model, testing)</span></code><button class="code-copy-button" title="Copy to Clipboard"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-12-output-1.png' %}"/></p>
</div>
</div>
<section class="level4" id="considering-this-model-is-using-a-single-raw-datapoint-as-a-predictor-the-performance-here-is-noteworthy.">
<h4 class="anchored" data-anchor-id="considering-this-model-is-using-a-single-raw-datapoint-as-a-predictor-the-performance-here-is-noteworthy.">Considering this model is using a single raw datapoint as a predictor, the performance here is noteworthy.</h4>
<p>For both cohorts that experience dramatic over prediction at 60 days, this model lowers the error. In the case of <code>06/26</code>, the error at 60 days out is cut in <em>half</em>!! Unsurprisingly, this model is highly inflexible, and the production model outperforms this model consistently around 40 days.</p>
<p>Let’s add some more information about cohort size:</p>
<div class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-13-output-1.png' %}"/></p>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-14-output-1.png' %}"/></p>
</div>
</div>
</section>
</section>
<section class="level2" id="averaging-the-predictions-of-the-prod-model-with-the-cohort-size-model">
<h2 class="anchored" data-anchor-id="averaging-the-predictions-of-the-prod-model-with-the-cohort-size-model">Averaging the predictions of the prod model with the cohort size model</h2>
<div class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<p><img class="img-fluid" src="{%  static 'projects/product/matriculation_forecasting_error/index_files/figure-html/cell-15-output-1.png' %}"/></p>
</div>
</div>
<script src="https://unpkg.com/@lyket/widget@latest/dist/lyket.js?apiKey=pt_00afa5bb7b98182c1dfaff75311c5e"></script>
<div data-lyket-id="product__matriculation_forecasting_error" data-lyket-namespace="irondata" data-lyket-type="clap"></div>
</section>
</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
</body></html>
    {% if 'share' in request.path %}
    <script>
        var element = document.getElementById("copy-button");
        element.remove();
    </script>
    {% endif %}

